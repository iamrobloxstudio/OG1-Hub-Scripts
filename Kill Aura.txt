-- ⚡ ULTRA KILL AURA — MICRO BURST ESCAPE MODE ⚡

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

-- CONFIG
local auraRange = 20
local auraSize = Vector3.new(30,30,30)

-- STATE
local Run = true
local connections = {}
local IgnoreList = OverlapParams.new()
IgnoreList.FilterType = Enum.RaycastFilterType.Include

-- HELPERS
local function GetCharacter(plr)
	return (plr or lp).Character
end

local function GetHumanoid(plr)
	local char = plr:IsA("Model") and plr or GetCharacter(plr)
	return char and char:FindFirstChildWhichIsA("Humanoid")
end

local function GetTouchPart(tool)
	return tool and tool:FindFirstChildWhichIsA("TouchTransmitter", true) and tool:FindFirstChildWhichIsA("TouchTransmitter", true).Parent
end

local function GetEnemyCharacters(localChar)
	local characters = {}
	for _, p in ipairs(Players:GetPlayers()) do
		local char = GetCharacter(p)
		if char and char ~= localChar then
			table.insert(characters, char)
		end
	end
	return characters
end

local function ActivateTool(tool)
	if tool:IsDescendantOf(workspace) then
		task.spawn(function()
			pcall(tool.Activate, tool)
		end)
	end
end

-- DAMAGE APPLICATION
local function ApplyDamage(Tools, Characters, TouchPart)
	if not TouchPart then return end
	local InstancesInBox = workspace:GetPartBoundsInBox(
		TouchPart.CFrame,
		TouchPart.Size + auraSize,
		IgnoreList
	)
	local totalDamage = #Tools
	for _, v in ipairs(InstancesInBox) do
		local Character = v:FindFirstAncestorWhichIsA("Model")
		if Character and table.find(Characters, Character) then
			for _ = 1, totalDamage do
				task.spawn(function()
					firetouchinterest(TouchPart, v, 1)
					firetouchinterest(TouchPart, v, 0)
				end)
			end
		end
	end
end

-- SPAWN / RESPAWN HANDLER
local function OnCharacterSpawned()
	local char = GetCharacter()
	if not char then return end

	local Tools = {}
	local Characters = GetEnemyCharacters(char)
	IgnoreList.FilterDescendantsInstances = Characters

	for _, tool in ipairs(char:GetChildren()) do
		if tool:IsA("Tool") and GetTouchPart(tool) then
			table.insert(Tools, tool)
			local TouchPart = GetTouchPart(tool)
			ActivateTool(tool)           -- immediate activation
			ApplyDamage(Tools, Characters, TouchPart) -- immediate micro burst
		end
	end
end

lp.CharacterAdded:Connect(OnCharacterSpawned)

-- MAIN LOOP (MAX RESPONSE)
RunService.Stepped:Connect(function()
	if not Run then return end
	local char = GetCharacter()
	if not char then return end
	local humanoid = GetHumanoid(char)
	if not humanoid then return end

	local Tools = {}
	local Characters = GetEnemyCharacters(char)
	IgnoreList.FilterDescendantsInstances = Characters

	for _, tool in ipairs(char:GetChildren()) do
		if tool:IsA("Tool") and GetTouchPart(tool) then
			table.insert(Tools, tool)
			local TouchPart = GetTouchPart(tool)
			ActivateTool(tool)
			ApplyDamage(Tools, Characters, TouchPart)
		end
	end
end)