-- ⚡ ULTRA HITBOX — RED OUTLINE, NO FREEZE ⚡

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local lp = Players.LocalPlayer

-- CONFIG
local detectionRange = 20
_G.Disabled = false
_G.ToggleKey = Enum.KeyCode.J
_G.HitboxSize = Vector3.new(15,15,15)

-- Cache hitboxes
local hitboxes = {}

-- GUI for showing target
local gui = lp:WaitForChild("PlayerGui")
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,200,0,50)
frame.Position = UDim2.new(0.5,-100,0.1,0)
frame.BackgroundTransparency = 0.5
frame.BackgroundColor3 = Color3.new(0,0,0)
frame.Visible = false
frame.Parent = gui

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1,0,1,0)
label.BackgroundTransparency = 1
label.TextColor3 = Color3.new(1,1,1)
label.TextScaled = true
label.Parent = frame

-- Find closest player
local function findClosestTarget()
    local closest, minDist = nil, detectionRange
    local char = lp.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= lp and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (char.HumanoidRootPart.Position - p.Character.HumanoidRootPart.Position).Magnitude
            if dist <= minDist then
                closest = p
                minDist = dist
            end
        end
    end
    return closest
end

-- Create hitbox outline once
local function createHitbox(player)
    if hitboxes[player] then return hitboxes[player] end
    local char = player.Character
    if not char then return nil end

    local hitbox = Instance.new("Part")
    hitbox.Name = "ULTRA_Hitbox"
    hitbox.Size = _G.HitboxSize
    hitbox.Transparency = 1
    hitbox.Anchored = false
    hitbox.CanCollide = false
    hitbox.Massless = true
    hitbox.Parent = char

    local box = Instance.new("SelectionBox")
    box.Adornee = hitbox
    box.LineThickness = 0.05
    box.Color3 = Color3.new(1,0,0) -- red outline
    box.SurfaceTransparency = 1
    box.Parent = hitbox

    hitboxes[player] = hitbox
    return hitbox
end

-- Toggle
UIS.InputBegan:Connect(function(input,gp)
    if not gp and input.KeyCode == _G.ToggleKey then
        _G.Disabled = not _G.Disabled
        if not _G.Disabled then
            frame.Visible = true
        else
            frame.Visible = false
        end
    end
end)

-- Heartbeat loop for fast detection
RunService.Heartbeat:Connect(function()
    if _G.Disabled then return end
    local closest = findClosestTarget()
    if closest and closest.Character and closest.Character:FindFirstChild("HumanoidRootPart") then
        label.Text = "Following: "..closest.Name
        frame.Visible = true
        local hitbox = createHitbox(closest)
        if hitbox then
            hitbox.CFrame = closest.Character.HumanoidRootPart.CFrame
        end
    else
        frame.Visible = false
    end
end)